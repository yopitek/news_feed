name: ğŸ”„ Sync to Personal Blog

on:
  # åœ¨ update-news workflow å®Œæˆå¾Œè‡ªå‹•åŸ·è¡Œ
  workflow_run:
    workflows: ["Daily Multilingual News Digest"]
    types:
      - completed
  
  # ä¹Ÿå¯ä»¥æ‰‹å‹•è§¸ç™¼
  workflow_dispatch:

jobs:
  sync-to-blog:
    runs-on: ubuntu-latest
    # åªåœ¨ update-news workflow æˆåŠŸæ™‚åŸ·è¡Œ
    if: ${{ github.event.workflow_run.conclusion == 'success' || github.event_name == 'workflow_dispatch' }}
    
    steps:
      - name: ğŸ“¥ Checkout news_feed repo
        uses: actions/checkout@v4
        with:
          path: news_feed
      
      - name: ğŸ“¥ Checkout personal_blogv1 repo
        uses: actions/checkout@v4
        with:
          repository: yopitek/personal_blogv1
          token: ${{ secrets.PERSONAL_BLOG_TOKEN }}
          path: personal_blogv1
      
      - name: ğŸ“‚ Create news_feed directory if not exists
        run: |
          mkdir -p personal_blogv1/static/news_feed
      
      - name: ğŸ”„ Sync files to personal blog
        run: |
          # è¤‡è£½ä¸»è¦çš„ HTML æ–‡ä»¶
          if [ -f "news_feed/index.html" ]; then
            cp news_feed/index.html personal_blogv1/static/news_feed/
            echo "âœ… Copied index.html"
          fi
          
          # å¦‚æœæœ‰ docs ç›®éŒ„ï¼Œä¹Ÿè¤‡è£½
          if [ -d "news_feed/docs" ]; then
            cp -r news_feed/docs/* personal_blogv1/static/news_feed/
            echo "âœ… Copied docs directory"
          fi
          
       # å¦‚æœ output ç›®éŒ„æœ‰å¯è¦‹æª”æ¡ˆæ‰è¤‡è£½ï¼ˆé¿å…ç©ºç›®éŒ„éŒ¯èª¤ï¼‰
if [ -d "news_feed/output" ]; then
  VISIBLE_FILES=$(find news_feed/output -maxdepth 1 -type f ! -name ".*" | head -1)
  if [ -n "$VISIBLE_FILES" ]; then
    mkdir -p personal_blogv1/static/news_feed/output
    cp -r news_feed/output/* personal_blogv1/static/news_feed/output/ 2>/dev/null || true
    echo "âœ… Copied output directory"
  else
    echo "â„¹ï¸ Output directory is empty or only contains hidden files, skipping"
  fi
fi
          
          # é¡¯ç¤ºè¤‡è£½çš„æ–‡ä»¶
          echo "ğŸ“‹ Files in static/news_feed:"
          ls -lh personal_blogv1/static/news_feed/
      
      - name: ğŸš€ Commit and push to personal_blogv1
        run: |
          cd personal_blogv1
          
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "GitHub Actions Bot"
          
          # æ·»åŠ æ‰€æœ‰æ›´æ”¹çš„æ–‡ä»¶
          git add static/news_feed/
          
          # æª¢æŸ¥æ˜¯å¦æœ‰æ›´æ”¹
          if git diff --staged --quiet; then
            echo "â„¹ï¸ No changes to commit"
          else
            COMMIT_DATE=$(date +%Y-%m-%d)
            git commit -m "ğŸ”„ Auto-sync news_feed - $COMMIT_DATE"
            
            git push
            echo "âœ… Changes pushed to personal_blogv1"
          fi
      
      - name: ğŸ“Š Summary
        run: |
          echo "======================================================================"
          echo "ğŸ‰ News feed synced successfully!"
          echo "======================================================================"
          echo ""
          echo "ğŸ“… Date: $(date +%Y-%m-%d\ %H:%M:%S)"
          echo "ğŸŒ News Feed URL: https://yopitek.github.io/news_feed/"
          echo "ğŸŒ Blog URL: https://zennote.app/news_feed/"
          echo ""
          echo "âœ… Sync workflow completed"
